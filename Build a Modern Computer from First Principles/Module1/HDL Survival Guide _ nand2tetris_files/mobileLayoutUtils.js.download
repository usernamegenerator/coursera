define(["lodash","coreUtilsLib"],function(n,t){return function(n){var t={};function e(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return n[o].call(r.exports,r,r.exports,e),r.l=!0,r.exports}return e.m=n,e.c=t,e.d=function(n,t,o){e.o(n,t)||Object.defineProperty(n,t,{enumerable:!0,get:o})},e.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},e.t=function(n,t){if(1&t&&(n=e(n)),8&t)return n;if(4&t&&"object"==typeof n&&n&&n.__esModule)return n;var o=Object.create(null);if(e.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:n}),2&t&&"string"!=typeof n)for(var r in n)e.d(o,r,function(t){return n[t]}.bind(null,r));return o},e.n=function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(t,"a",t),t},e.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},e.p="",e(e.s=7)}([function(t,e){t.exports=n},function(n,t,e){"use strict";e.r(t),e.d(t,"isMergeVirtualGroup",function(){return u}),e.d(t,"isRescaleVirtualGroup",function(){return c}),e.d(t,"isVirtualGroup",function(){return s}),e.d(t,"isDesktopOnlyComponent",function(){return a}),e.d(t,"isTextComponent",function(){return f}),e.d(t,"isGraphicComponent",function(){return l}),e.d(t,"isGroupComponent",function(){return d}),e.d(t,"isColumnsContainerComponent",function(){return p}),e.d(t,"isImageComponent",function(){return m}),e.d(t,"isMasterPage",function(){return y}),e.d(t,"isDockingAllowed",function(){return g}),e.d(t,"isFixedPositionAllowed",function(){return v}),e.d(t,"shouldStretchToScreenWidth",function(){return E}),e.d(t,"extractComponentsFromStructureByType",function(){return h}),e.d(t,"isScreenWidthComponent",function(){return T}),e.d(t,"translateComps",function(){return _}),e.d(t,"reparentComponent",function(){return D}),e.d(t,"addComponentsTo",function(){return R}),e.d(t,"removeChildrenFrom",function(){return x}),e.d(t,"removeGroup",function(){return N}),e.d(t,"containsComponent",function(){return O}),e.d(t,"getHeightAccordingToChildren",function(){return I}),e.d(t,"ensureContainerTightlyWrapsChildren",function(){return C}),e.d(t,"isSiteSegmentOrPage",function(){return P}),e.d(t,"isPageComponent",function(){return S}),e.d(t,"isContainerComponent",function(){return M}),e.d(t,"isSiteSegment",function(){return b}),e.d(t,"isAllowedToBeInMasterPage",function(){return A}),e.d(t,"extractMobilePage",function(){return G}),e.d(t,"getComponentByIdFromStructure",function(){return L}),e.d(t,"unifyGroups",function(){return V}),e.d(t,"getComponentsByIds",function(){return z}),e.d(t,"getParent",function(){return w}),e.d(t,"getSnugLayout",function(){return j}),e.d(t,"getTinyMenuDefaultPosition",function(){return B}),e.d(t,"getChildren",function(){return F}),e.d(t,"getRangesOverlap",function(){return U}),e.d(t,"getYOverlap",function(){return H}),e.d(t,"getXOverlap",function(){return Y}),e.d(t,"hasGreaterArea",function(){return k}),e.d(t,"haveSufficientOverlap",function(){return X}),e.d(t,"isEmptyContainer",function(){return Z}),e.d(t,"shouldReparentCompToChildOfContainer",function(){return q}),e.d(t,"getAllCompsInStructure",function(){return $});var o=e(0),r=e(2),i=e(4);const u=n=>o.get(n,"componentType")===r.a.VIRTUAL_GROUP_TYPES.MERGE,c=n=>o.get(n,"componentType")===r.a.VIRTUAL_GROUP_TYPES.RESCALE,s=n=>c(n)||u(n);function a(n){return o.get(n,["conversionData","desktopOnly"],!1)}function f(n){return"text"===o.get(n,["conversionData","category"])}function l(n){return"graphic"===o.get(n,["conversionData","category"])||m(n)}function d(n){return n&&"wysiwyg.viewer.components.Group"===n.componentType}function p(n){return"columns"===o.get(n,["conversionData","category"])}function m(n){return"photo"===o.get(n,["conversionData","category"])}function y(n){return"masterPage"===o.get(n,"id")}function g(n){return o.get(n,["conversionData","isDockingAllowed"])}function v(n){return o.get(n,["conversionData","isFixedPositionAllowed"])}function E(n){const t=n=>o.get(n.conversionData,"isScreenWidth",!1)||o.get(n.conversionData,"stretchHorizontally",!1)||o.some(n.components,t);return P(n)||t(n)}function h(n,t){const e=F(n),r=o.remove(e,n=>o.includes(t,n.componentType));return o.concat(r,o.flatMap(e,h))}function T(n){return o.get(n.conversionData,"isScreenWidth",!1)||o.some(n.components,T)}function _(n,t=0,e=0){o.forEach(n,n=>{n.layout.x+=t,n.layout.y+=e})}function D(n,t,e){R(n,[t],e),_([t],-n.layout.x,-n.layout.y)}function R(n,t,e){const o=F(n);t.length&&o&&(e=void 0!==e?e:o.length,o.splice.apply(o,[e,0].concat(t)))}function x(n,t){const e=F(n);o.remove(e,n=>o.includes(t,n))}function N(n,t){if(!d(n))return;const e=o.findIndex(t.components,{id:n.id});o.forEach(n.components.reverse(),o=>{R(t,[o],e),_([o],n.layout.x,n.layout.y)}),o.remove(t.components,n)}function O(n,t){return o.some(F(n),n=>t(n)||n&&O(n,t))}function I(n,t,e){if(y(n))return;if(!t||!e&&o.isEmpty(t))return;const i=o(t).reject(["conversionData.isInvisible",!0]).reduce((n,t)=>o.max([n,t.layout.y+t.layout.height,0]),0);return o.get(n,["conversionData","hasTightYMargin"])||o.get(n,["conversionData","hasTightBottomMargin"])?i:i+(E(n)?r.a.SECTION_MOBILE_MARGIN_Y:r.a.COMPONENT_MOBILE_MARGIN_Y+o.get(n.conversionData,"borderWidth",0))}function C(n,t,e,r=0){const i=I(n,t,e);if(o.isNumber(i)){const t=o.get(n,["conversionData","minHeight"],r);n.layout.height=Math.max(t,i)}}function P(n){return S(n)||b(n)}function S(n){return"Page"===n.type}function M(n){return"Container"===n.type}function b(n){return o.has(n.conversionData,"siteSegmentRole")}function A(n){return b(n)||o.has(n.conversionData,"isAllowedToBeChildOfMasterPage")}function G(n){const t=i.objectUtils.cloneDeep(n),e=o.has(t,"components")?"components":"children";return o.set(t,e,n.mobileComponents||[])}function L(n,t){if(t.id===n)return t;let e=null;return o.find(F(t),t=>e=L(n,t)),e}function V(n,t){if(n.length>t)return void(n.length=0);const e=(n,t)=>o.size(o.intersection(n,t))>0;for(let t=n.length-1;t>=0;t--){const r=o.findLastIndex(n,(o,r)=>r<t&&e(n[t],o));-1!==r&&(n[r]=n[r].concat(o.difference(n[t],n[r])),n.splice(t,1))}}function z(n,t){const e=F(n);return o.map(t,n=>o.find(e,{id:n})||null)}function w(n,t){const e=F(t);if(o.find(e,{id:n}))return t;let r=null;return o.find(e,t=>r=w(n,t)),r}function j(n){if(!n||0===n.length)return;const t=o.min(o.map(n,"layout.x")),e=o.min(o.map(n,"layout.y"));return{x:t,y:e,width:o.max(o.map(n,n=>n.layout.x+n.layout.width))-t,height:o.max(o.map(n,n=>n.layout.y+n.layout.height))-e,rotationInDegrees:0}}function B(){return{x:r.a.MOBILE_WIDTH-(r.a.TINY_MENU_SIZE+r.a.SITE_SEGMENT_PADDING_X),y:r.a.SECTION_MOBILE_MARGIN_Y,rotationInDegrees:0}}function F(n){return n.components||n.children}function U(n=[],t=[]){const e=(n,t)=>Math.min(n[1],t[1])-t[0];return n[0]<=t[0]?e(n,t):e(t,n)}function H(n,t){const e=n=>[n.layout.y,n.layout.height+n.layout.y];return U(e(n),e(t))}function Y(n,t){if(T(n))return t.layout.width;if(T(t))return n.layout.width;const e=n=>[n.layout.x,n.layout.width+n.layout.x];return U(e(n),e(t))}const W=n=>n.layout.width*n.layout.height;function k(n,t){return T(n)?n.layout.height>=t.layout.height||W(n)>W(t):!T(t)&&W(n)>W(t)}function X(n,t,e){const o=Y(n,t),r=H(n,t);if(o<=0||r<=0)return!1;const i=o*r,u=Math.min(W(n),W(t));return i>0&&i/u>=e}function Z(n){return!!M(n)&&("columns"===n.conversionData.category?1===o.size(n.components)&&o.isEmpty(n.components[0].components):o.isEmpty(n.components))}function q(n,t){return p(t)&&o.get(n,["conversionData","isInvisible"],!1)}function $(n,t=!1,e){const r=[[n]];for(const n of r)o.forEach(n,n=>{const e=t?o.get(n,"mobileComponents"):F(n);o.isEmpty(e)||r.push(e)});return o(r).flatten().remove(e).keyBy("id").value()}},function(n,t,e){"use strict";e.d(t,"a",function(){return o});const o={MOBILE_WIDTH:320,MARGIN_BETWEEN_TEXT_AND_NON_TEXT:20,COMPONENT_MOBILE_MARGIN_X:10,COMPONENT_MOBILE_MARGIN_Y:10,SECTION_MOBILE_MARGIN_Y:20,SITE_SEGMENT_PADDING_X:20,TINY_MENU_SIZE:50,TEXT_MAX_LENGTH_FOR_RESCALING:25,MIN_WIDTH_FOR_ENLARGE:140,DEFAULT_TEXT_HEIGHT:10,VIRTUAL_GROUP_TYPES:{RESCALE:"RESCALE_VIRTUAL_GROUP",MERGE:"MERGE_VIRTUAL_GROUP"}}},function(n,t,e){"use strict";e.d(t,"e",function(){return u}),e.d(t,"c",function(){return c}),e.d(t,"b",function(){return s}),e.d(t,"a",function(){return f}),e.d(t,"d",function(){return d}),e.d(t,"g",function(){return p}),e.d(t,"h",function(){return m}),e.d(t,"f",function(){return y});var o=e(0),r=e(1);const i=.1,u=n=>0===n?0:n/Math.abs(n),c=(n,t)=>"x"===t?n.layout.width:n.layout.height,s=(n,t)=>n.layout[t]+c(n,t);function a(n,t,e,r=i){const u=o.get(n,e),c=o.get(t,e);return Math.abs(u-c)<=r*o.min([u,c])}function f(n,t,e){return n===t||o.size(n)===o.size(t)&&!l(n,e)&&!l(t,e)&&o.every(n,(n,r)=>{const u=t[r];return n.componentType===u.componentType&&function(n,t,e,r=i){const u=o.get(n,["layout",e]),s=o.get(t,["layout",e]);return Math.abs(u-s)<=r*o.min([c(n,e),c(t,e)])}(n,u,e)&&("text"===n.conversionData.category?a(n,u,["conversionData","averageNormalizedFontSize"]):a(n,u,["layout","height"])&&a(n,u,["layout","width"]))})}function l(n,t){const e=o.findIndex(n,(e,r)=>{if(0===r)return!1;const i=s(n[r-1],t),u=e.layout[t]-i;return u<0||u>o.min([c(n[r-1],t),c(e,t)])});return-1!==e&&e!==n.length-1}function d(n){const t=r.getChildren(n);return o.map(n.conversionData.componentsOrder,n=>o.find(t,{id:n}))}const p=n=>r.isRescaleVirtualGroup(n)&&"reorder"!==n.conversionData.rescaleMethod||n.conversionData.structuralContainer;function m(n,t){const e=o.map(r.getChildren(n),"id");return o.sortBy(t,n=>e.indexOf(n.id))}function y(n){const t=o.pick(n.conversionData.mobileHints,["recommendedWidth","recommendedHeight","recommendedScale","recommendedOrder"]);return!o.isEmpty(t)}},function(n,e){n.exports=t},function(n,t,e){"use strict";e.d(t,"a",function(){return g}),e.d(t,"b",function(){return v}),e.d(t,"c",function(){return O});var o=e(0),r=e(3),i=e(4);const u={START_EVENT:"start",END_EVENT:"end"},c=.9,s={HORIZONTAL:1,VERTICAL:1.25};function a(n,t){return o.transform(n,(n,e,o)=>{const r=t(o);return n[r]=n[r]||{comps:[],distanceToPreviousFragment:e.distanceToPreviousFragment},n[r].comps=[...n[r].comps,...e.comps],n},[])}const f={singleCompRow(n,t,e){if("x"===e)return null;const i=o.findIndex(n,n=>1===o.size(n.comps));if(-1===i)return null;const u=a(n,n=>Object(r.e)(n-i)+Object(r.e)(i));return{type:"singleCompRow",fragments:u,fragmentsEvents:_(t,u)}},verticalDivider(n,t,e){if(o.size(n)<3||o.every(n,n=>1===o.size(n.comps))||"y"===e)return null;const i=function(n,t){const e=o(t.y).partition({eventType:u.START_EVENT}).map(n=>o.map(n,"coordinate")).value(),i=o.max(e[0]),c=o.min(e[1]);return o.findIndex(n,n=>{const t=n.comps[0];return 1===n.comps.length&&t.conversionData.keepIfVerticalDivider&&t.layout.y<=c&&Object(r.b)(t,"y")>=i})}(n,t);if(-1===i)return null;o.set(n[i].comps[0],["conversionData","isVerticalDivider"],!0);const c=a(n,n=>Object(r.e)(n-i)+Object(r.e)(i));return{type:"verticalDivider",fragments:c,fragmentsEvents:_(t,c)}},mirrorPattern(n,t,e){if(o.size(n)<2)return null;const i=_(t,n),u=d(e),c=o.map(i,n=>l(n[u])),s=o.every(c,n=>Object(r.a)(n,c[0],u));return s&&s?m(o.flatten(c),t,{type:"mirrorPattern"}):null},chessPattern(n,t,e){if("y"!==e||o.size(n)<2||!o.every(n,n=>2===o.size(n.comps)))return null;const r=_(t,n),i=o.map(r,n=>l(n.x)),u=o.flatMap(i,(n,t)=>p(t)?n:o.reverse(n)),c=u[0].conversionData.category,s="text"===c?"photo":"text";return o.every(u,(n,t)=>n.conversionData.category===(p(t)?c:s))?m(u,t,{type:"chessPattern"}):null}},l=n=>o(n).map("compRef").uniq().value(),d=n=>"x"===n?"y":"x",p=n=>n%2==0;function m(n,t,e){return o.assign(e,{fragments:[{comps:n,distanceToPreviousFragment:-1}],fragmentsEvents:[t]})}function y(n,t){const e=o.findLastIndex(n,n=>{if(n.coordinate===t.coordinate){if(n.eventType===u.START_EVENT&&t.eventType===u.START_EVENT)return n.size>t.size;if(n.eventType===u.END_EVENT&&t.eventType===u.END_EVENT)return n.size<t.size;if(n.eventType===u.START_EVENT&&t.eventType===u.END_EVENT)return n.compRef===t.compRef;if(n.eventType===u.END_EVENT&&t.eventType===u.START_EVENT)return n.compRef!==t.compRef}return n.coordinate<t.coordinate});return n.splice(e+1,0,t),n}function g(n,t){const e=o.transform(n,(n,e)=>{const o=e.layout[t]||0,i=Object(r.b)(e,t)||o,c=Object(r.c)(e,t)||0;return y(n,{eventType:u.START_EVENT,compRef:e,coordinate:o,size:c}),y(n,{eventType:u.END_EVENT,compRef:e,coordinate:i,size:c}),n},[]);return o.map(e,n=>o.omit(n,"size"))}function v(n){const t=[],e=[];return o.forEach(n,n=>{const r=o.last(e);if(n.eventType===u.START_EVENT){if(o.isEmpty(t)){const t={events:[n],distanceToPreviousFragment:r?n.coordinate-o.last(r.events).coordinate:-1};e.push(t)}else r.events.push(n);t.push(n)}else o.remove(t,{compRef:n.compRef}),r.events.push(n)}),o.map(e,n=>({comps:l(n.events),distanceToPreviousFragment:n.distanceToPreviousFragment}))}function E(n,t,e){const r=o.maxBy(n,"distanceToPreviousFragment"),i=o.findIndex(n,r),u=a(n,n=>n<i?0:1),c=[n[i-1],r],s=o.filter(t[d(e)],n=>o.some(c,t=>o.includes(t.comps,n.compRef))),f={fragmentsEvents:_(t,u),fragments:u},l=h(c,s,e);return o.assign(f,{maxCompsDistance:l})}function h(n,t,e){const i=function(n,t){return o(n).map((n,e)=>e?o.map(n,n=>o.defaults({closestPoint:n.compRef.layout[t]},n)):o.map(n,n=>o.defaults({closestPoint:Object(r.b)(n.compRef,t)},n))).map((n,t)=>o.reduce(n,(n,e)=>{const r=o.last(n);return r&&r.eventType!==u.END_EVENT?r.compRef===e.compRef?[...n,e]:((t&&e.closestPoint<r.closestPoint||!t&&e.closestPoint>r.closestPoint)&&n.splice(n.length-1,1,e),n):n.concat(e.eventType===u.START_EVENT?[e]:[])},[])).value()}(o.partition(t,t=>o.includes(n[0].comps,t.compRef)),e),c=[0,0],s=[[],[]];let a=-1/0;for(;c[0]<i[0].length||c[1]<i[1].length;){const n=c[0]===i[0].length||c[1]===i[1].length?c[0]===i[0].length?1:0:i[0][c[0]].coordinate<=i[1][c[1]].coordinate?0:1,t=i[n][c[n]++];if(t.eventType===u.END_EVENT){o.remove(s[n],{compRef:t.compRef});continue}s[n].push(t);const e=[o.maxBy(s[0],"closestPoint"),o.minBy(s[1],"closestPoint")],r=o.get(e,[1,"closestPoint"])-o.get(e,[0,"closestPoint"]);!o.isNaN(r)&&r>a&&(a=r)}return a}function T(n,t){return o.transform(n,(n,e)=>{const r=o.findIndex(t,n=>o.includes(n.comps,e.compRef));return n[r]=[...n[r]||[],e],n},[])}function _(n,t){const e=T(n.x,t),r=T(n.y,t);return o.map(o.keys(t),n=>o.assign({},{x:e[n],y:r[n]}))}function D(n,t,e){return function(n,t,e){let r=null;return o.forEach(f,(o,i)=>{if(!e[i])return!0;const u=o(t.y,n,"y"),c=o(t.x,n,"x");return null===(r=u&&c?null:u||c)}),r}(n,t,e)||function(n,t){const e=o.size(t.x)>1?E(t.x,n,"x"):null,r=o.size(t.y)>1?E(t.y,n,"y"):null;if(e&&r){const n=s.HORIZONTAL*e.maxCompsDistance>s.VERTICAL*r.maxCompsDistance?e:r;return o.pick(n,["fragments","fragmentsEvents"])}return e||r}(n,t)}function R(n,t,e,i){if(o.size(t)<2)return t||[];const u=o.mapValues(e,v);if(1===o.size(u.x)&&1===o.size(u.y))return i.detectSemanticGroups?i.useOverlapRules?function(n,t){t=Object(r.h)(n,t);const e=`overlayGroup_${(t=o.sortBy(t,"layout.y"))[0].id}`;return o.forEach(t,n=>o.set(n,["conversionData","overlayGroupId"],e)),t}(n,t):function(n,t,e){const r=n=>o.some(n,"conversionData.originalLayout");if(r(t)||o.some(t,n=>r(n)))return N(t),t;x(t);const i=g(t,"y"),u=g(t,"x"),c=R(n,t,{y:i,x:u},e);return N(c),c}(n,t,i):Object(r.h)(n,t);const c=D(e,u,{mirrorPattern:i.detectSemanticGroups,chessPattern:i.detectSemanticGroups,verticalDivider:!0,singleCompRow:!0});return 1===o.size(c.fragments)?c.fragments[0].comps:o.flatMap(c.fragments,(t,e)=>R(n,t.comps,c.fragmentsEvents[e],i))}function x(n){o.forEach(n,n=>{const t=n.layout,e=o.assign(i.objectUtils.cloneDeep(t),{height:t.height*c,width:t.width*c});n.layout=e,o.set(n,["conversionData","originalLayout"],t)})}function N(n,t=!0){o.forEach(n,n=>{const t=o.get(n,["conversionData","originalLayout"]);t&&(n.layout=i.objectUtils.cloneDeep(t),delete n.conversionData.originalLayout)}),t&&o.forEach(n,n=>N(n.components,!1))}function O(n,t,e){const r=R(n,t,{y:g(t,"y"),x:g(t,"x")},e);n.conversionData.componentsOrder=o.map(r,"id")}r.h},,function(n,t,e){"use strict";e.r(t);var o=e(1),r=e(0),i=e(5);function u(n,t){const e=i.a(n,t);return i.b(e)}function c(n){if(r.size(n)<=1)return n;const t=r.map(u(n,"y"),"comps");return r.reduce(t,(t,e)=>{if(1===r.size(e))return t.concat(e);const o=r.map(u(e,"x"),"comps"),i=r.flatMap(o,t=>1===r.size(t)?t:r.sortBy(t,r.findIndex.bind(null,n)));return t.concat(i)},[])}function s(n){const t=o.getChildren(n);if(!t)return{};const e=c(t),i=r.set({},n.id,r.map(e,"id")),u=r.map(t,s);return r.assign.apply(r,[i].concat(u))}e.d(t,"translateComponents",function(){return o.translateComps}),e.d(t,"getSnugLayout",function(){return o.getSnugLayout}),e.d(t,"splitToFragments",function(){return u}),e.d(t,"sortSiblings",function(){return c}),e.d(t,"getComponentsOrder",function(){return s})}])});
//# sourceMappingURL=mobileLayoutUtils.js.map